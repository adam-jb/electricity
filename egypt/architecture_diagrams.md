


```

YOUR SYSTEM                           EGYPT PARTNER
     │                                      │
     │  1. POST /transfer                   │
     │  {amount_usdc, recipient_details}    │
     │  ─────────────────────────────────►  │
     │                                      │
     │  2. Response: {transfer_id, status}  │
     │  ◄─────────────────────────────────  │
     │                                      │
     │  3. Send USDC to partner wallet      │
     │  (on-chain transaction)              │
     │  ─────────────────────────────────►  │
     │                                      │
     │  4. Webhook: transfer_confirmed      │
     │  ◄─────────────────────────────────  │
     │                                      │
     │  [Partner converts USDC → EGP]       │
     │  [Partner pays out to recipient]     │
     │                                      │
     │  5. Webhook: payout_completed        │
     │  {reference, actual_egp_amount}      │
     │  ◄─────────────────────────────────  │



 ┌─────────────────────────────────────────────────────────────────────────────────────────┐
 │                                   COST SUMMARY                                           │
 ├─────────────────────────────────────────────────────────────────────────────────────────┤
 │                                                                                          │
 │   INFRASTRUCTURE (MONTHLY FIXED)                                                         │
 │   ─────────────────────────────────────────────────────────────────                      │
 │   Vercel (frontend)                    $20                                               │
 │   Render Pro x2 (API + worker)         $50                                               │
 │   Neon/Supabase (PostgreSQL)           $25                                               │
 │   Upstash (Redis)                      $10                                               │
 │   AWS S3                               $5                                                │
 │   ─────────────────────────────────────────────────────────────────                      │
 │   SUBTOTAL                             $110/month                                        │
 │                                                                                          │
 │                                                                                          │
 │   SAAS (MONTHLY FIXED)                                                                   │
 │   ─────────────────────────────────────────────────────────────────                      │
 │   Plaid (base)                         $500  (includes some tx)                          │
 │   Monitoring (Sentry free tier)        $0                                                │
 │   ─────────────────────────────────────────────────────────────────                      │
 │   SUBTOTAL                             $500/month                                        │
 │                                                                                          │
 │                                                                                          │
 │   PER-TRANSACTION (on $500 transfer)                                                     │
 │   ─────────────────────────────────────────────────────────────────                      │
 │   ACH pull (Plaid or Bridge)           $0.10 - $0.30                                     │
 │   USD → USDC (Circle)                  $0.00                                             │
 │   Blockchain (Solana)                  $0.001                                            │
 │   Egypt conversion + payout            $4.00 - $10.00  (0.8-2%)                          │
 │   ─────────────────────────────────────────────────────────────────                      │
 │   SUBTOTAL                             $4.10 - $10.30 per tx                             │
 │                                                                                          │
 │                                                                                          │
 │   PER-USER (ONE-TIME)                                                                    │
 │   ─────────────────────────────────────────────────────────────────                      │
 │   KYC (Persona or Plaid Identity)      $0.50 - $2.00                                     │
 │   Bank linking (Plaid)                 $0.30                                             │
 │   ─────────────────────────────────────────────────────────────────                      │
 │   SUBTOTAL                             $0.80 - $2.30 per user                            │
 │                                                                                          │
 └─────────────────────────────────────────────────────────────────────────────────────────┘


 ┌─────────────────────────────────────────────────────────────────────────────────────────┐
 │                              TRANSFER STATE MACHINE                                      │
 └─────────────────────────────────────────────────────────────────────────────────────────┘

                                     ┌─────────────┐
                                     │  INITIATED  │
                                     └──────┬──────┘
                                            │
                                            ▼
                                   ┌─────────────────┐
                           ┌──────│ COMPLIANCE_CHECK │──────┐
                           │      └─────────────────┘       │
                           │                                │
                           ▼                                ▼
                    ┌────────────┐                  ┌──────────────┐
                    │  BLOCKED   │                  │ FUNDS_PULLING│
                    │ (end state)│                  └──────┬───────┘
                    └────────────┘                         │
                                                           ▼
                                                  ┌─────────────────┐
                                          ┌──────│  FUNDS_RECEIVED │──────┐
                                          │      └─────────────────┘      │
                                          │                               │
                                          ▼                               ▼
                                   ┌────────────┐                  ┌──────────────┐
                                   │   FAILED   │                  │  CONVERTING  │
                                   │ (ACH fail) │                  │  (USD→USDC)  │
                                   └────────────┘                  └──────┬───────┘
                                                                          │
                                                                          ▼
                                                                 ┌─────────────────┐
                                                                 │   IN_TRANSIT    │
                                                                 │ (USDC on-chain) │
                                                                 └────────┬────────┘
                                                                          │
                                                                          ▼
                                                               ┌───────────────────┐
                                                               │ PARTNER_RECEIVED  │
                                                               └─────────┬─────────┘
                                                                         │
                                                                         ▼
                                                               ┌───────────────────┐
                                                               │    PAYING_OUT     │
                                                               └─────────┬─────────┘
                                                                         │
                                                     ┌───────────────────┼───────────────────┐
                                                     │                   │                   │
                                                     ▼                   ▼                   ▼
                                             ┌────────────┐      ┌────────────┐      ┌────────────┐
                                             │   FAILED   │      │  COMPLETED │      │   REFUND   │
                                             │(payout fail)│     │            │      │ (reversed) │
                                             └────────────┘      └────────────┘      └────────────┘

```


## Data Flow Diagram

 ```
 ┌─────────────────────────────────────────────────────────────────────────────────────────┐
 │                                 COMPLETE DATA FLOW                                       │
 └─────────────────────────────────────────────────────────────────────────────────────────┘

      USER                    YOUR SYSTEM                 US SERVICES              EGYPT
        │                          │                           │                     │
        │  1. Signup               │                           │                     │
        │─────────────────────────►│                           │                     │
        │                          │  KYC request              │                     │
        │                          │──────────────────────────►│ Persona             │
        │◄─────────────────────────│◄──────────────────────────│                     │
        │  ID verified             │                           │                     │
        │                          │                           │                     │
        │  2. Link bank            │                           │                     │
        │─────────────────────────►│                           │                     │
        │                          │  Plaid Link               │                     │
        │                          │──────────────────────────►│ Plaid               │
        │◄─────────────────────────│◄──────────────────────────│                     │
        │  Bank linked             │                           │                     │
        │                          │                           │                     │
        │  3. Send $500            │                           │                     │
        │─────────────────────────►│                           │                     │
        │                          │                           │                     │
        │                          │  OFAC + AML check         │                     │
        │                          │  (internal)               │                     │
        │                          │                           │                     │
        │                          │  4. ACH pull              │                     │
        │                          │──────────────────────────►│ Plaid/Bridge        │
        │                          │                           │      │              │
        │                          │                           │      ▼              │
        │                          │                           │  User's Bank        │
        │                          │                           │      │              │
        │                          │                           │      ▼              │
        │                          │◄──────────────────────────│  Your US Account    │
        │                          │  $500 received            │                     │
        │                          │                           │                     │
        │                          │  5. USD → USDC            │                     │
        │                          │──────────────────────────►│ Circle              │
        │                          │◄──────────────────────────│                     │
        │                          │  500 USDC in wallet       │                     │
        │                          │                           │                     │
        │                          │  6. Send USDC             │                     │
        │                          │──────────────────────────────────────────────────►│
        │                          │                           │    Partner wallet   │
        │                          │                           │         │           │
        │                          │                           │    7. Convert       │
        │                          │                           │    USDC → EGP       │
        │                          │                           │         │           │
        │                          │                           │    8. Pay out       │
        │                          │                           │         │           │
        │                          │                           │         ▼           │
        │                          │◄──────────────────────────────────────────────────│
        │                          │  Webhook: complete        │    Recipient gets   │
        │◄─────────────────────────│                           │    24,750 EGP       │
        │  "Transfer complete"     │                           │                     │
        │                          │                           │                     │
 

 ---




 ┌─────────────────────────────────────────────────────────────────────────────────────────┐
 │                                    ARCHITECTURE OVERVIEW                                 │
 └─────────────────────────────────────────────────────────────────────────────────────────┘

                                     ┌─────────────────┐
                                     │   USERS         │
                                     │  Mobile / Web   │
                                     └────────┬────────┘
                                              │
                                              ▼
 ┌─────────────────────────────────────────────────────────────────────────────────────────┐
 │                                      FRONTEND                                            │
 │                                                                                          │
 │    ┌──────────────────────┐              ┌──────────────────────┐                       │
 │    │   Mobile App         │              │   Web App            │                       │
 │    │   (React Native)     │              │   (Next.js)          │                       │
 │    │                      │              │                      │                       │
 │    │   Expo / App Store   │              │   Vercel             │                       │
 │    │   $0/mo (free tier)  │              │   $20/mo             │                       │
 │    └──────────┬───────────┘              └──────────┬───────────┘                       │
 │               │                                     │                                    │
 └───────────────┼─────────────────────────────────────┼────────────────────────────────────┘
                 │                                     │
                 └──────────────┬──────────────────────┘
                                │
                                ▼
 ┌─────────────────────────────────────────────────────────────────────────────────────────┐
 │                                   API LAYER (Render)                                     │
 │                                                                                          │
 │    ┌────────────────────────────────────────────────────────────────────────────────┐   │
 │    │                           API Gateway / Main Server                             │   │
 │    │                           (NestJS on Render Pro - $25/mo)                       │   │
 │    │                                                                                 │   │
 │    │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │   │
 │    │   │Auth Service │  │Transfer Svc │  │Compliance   │  │Notification │          │   │
 │    │   │             │  │             │  │Service      │  │Service      │          │   │
 │    │   │- Signup     │  │- Initiate   │  │             │  │             │          │   │
 │    │   │- Login      │  │- Status     │  │- OFAC check │  │- SMS/Email  │          │   │
 │    │   │- JWT tokens │  │- History    │  │- AML rules  │  │- Push notif │          │   │
 │    │   └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘          │   │
 │    └────────────────────────────────────────────────────────────────────────────────┘   │
 │                                                                                          │
 └───────────────────────────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
 ┌─────────────────────────────────────────────────────────────────────────────────────────┐
 │                              BACKGROUND WORKERS (Render)                                 │
 │                                                                                          │
 │    ┌────────────────────────────────────────────────────────────────────────────────┐   │
 │    │                        Worker Process (Render Pro - $25/mo)                     │   │
 │    │                                                                                 │   │
 │    │   ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐               │   │
 │    │   │ Transfer Worker │  │ Webhook Handler │  │ Reconciliation  │               │   │
 │    │   │                 │  │                 │  │                 │               │   │
 │    │   │ - Process queue │  │ - Plaid events  │  │ - Daily ledger  │               │   │
 │    │   │ - Call Circle   │  │ - Circle events │  │   reconcile     │               │   │
 │    │   │ - Call Partner  │  │ - Partner events│  │ - OFAC list     │               │   │
 │    │   │                 │  │                 │  │   update        │               │   │
 │    │   └─────────────────┘  └─────────────────┘  └─────────────────┘               │   │
 │    └────────────────────────────────────────────────────────────────────────────────┘   │
 │                                                                                          │
 └───────────────────────────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
 ┌─────────────────────────────────────────────────────────────────────────────────────────┐
 │                                    DATA LAYER                                            │
 │                                                                                          │
 │   ┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐                 │
 │   │   PostgreSQL     │    │     Redis        │    │       S3         │                 │
 │   │   (Neon/Supabase)│    │   (Upstash)      │    │    (AWS)         │                 │
 │   │                  │    │                  │    │                  │                 │
 │   │   $25/mo         │    │   $10/mo         │    │   $5/mo          │                 │
 │   │                  │    │                  │    │                  │                 │
 │   │  - Users         │    │  - Sessions      │    │  - KYC docs      │                 │
 │   │  - Transfers     │    │  - Job queue     │    │  - Audit logs    │                 │
 │   │  - Ledger        │    │  - Rate limits   │    │  - Backups       │                 │
 │   │  - OFAC cache    │    │  - Cache         │    │                  │                 │
 │   └──────────────────┘    └──────────────────┘    └──────────────────┘                 │
 │                                                                                          │
 └───────────────────────────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
 ┌─────────────────────────────────────────────────────────────────────────────────────────┐
 │                              EXTERNAL SERVICES                                           │
 │                                                                                          │
 │   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
 │   │                              US SIDE                                             │   │
 │   │                                                                                  │   │
 │   │   ┌────────────────┐    ┌────────────────┐    ┌────────────────┐               │   │
 │   │   │   Plaid        │    │   Bridge       │    │   Circle       │               │   │
 │   │   │                │    │   (BaaS)       │    │                │               │   │
 │   │   │ - Bank linking │    │                │    │ - USD → USDC   │               │   │
 │   │   │ - ACH pull     │    │ - MTL license  │    │ - USDC custody │               │   │
 │   │   │ - Identity     │    │ - ACH/Wire     │    │ - On-chain tx  │               │   │
 │   │   │                │    │ - Compliance   │    │                │               │   │
 │   │   │ $0.30/tx       │    │ $0.10-0.20/tx  │    │ $0.00          │               │   │
 │   │   └────────────────┘    └────────────────┘    └────────────────┘               │   │
 │   │                                                                                  │   │
 │   │   [Choose: Plaid + Circle  OR  Bridge (handles both)]                           │   │
 │   └─────────────────────────────────────────────────────────────────────────────────┘   │
 │                                                                                          │
 │   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
 │   │                              KYC / COMPLIANCE                                    │   │
 │   │                                                                                  │   │
 │   │   ┌────────────────┐    ┌────────────────┐    ┌────────────────┐               │   │
 │   │   │   Persona      │    │   OFAC List    │    │   Twilio       │               │   │
 │   │   │                │    │   (Self-host)  │    │                │               │   │
 │   │   │ - ID verify    │    │                │    │ - SMS OTP      │               │   │
 │   │   │ - Selfie match │    │ - SDN list     │    │ - Notifications│               │   │
 │   │   │                │    │ - Daily update │    │                │               │   │
 │   │   │ $2/user        │    │ $0             │    │ $0.01/SMS      │               │   │
 │   │   └────────────────┘    └────────────────┘    └────────────────┘               │   │
 │   └─────────────────────────────────────────────────────────────────────────────────┘   │
 │                                                                                          │
 │   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
 │   │                              EGYPT SIDE  - ADAM: WE WOULDNT USE Yellow Card - too expensive
 │   │                                                                                  │   │
 │   │   ┌────────────────┐    ┌────────────────┐    ┌────────────────┐               │   │
 │   │   │ Egypt Partner  │    │   InstaPay     │    │  Mobile Money  │               │   │
 │   │   │ (Yellow Card/  │    │   (via partner)│    │  (via partner) │               │   │
 │   │   │  Paymob)       │    │                │    │                │               │   │
 │   │   │                │    │ - Bank xfer    │    │ - Vodafone Cash│               │   │
 │   │   │ - USDC accept  │    │ - Instant      │    │ - Orange Money │               │   │
 │   │   │ - EGP convert  │    │                │    │ - Fawry cash   │               │   │
 │   │   │ - Payout       │    │                │    │                │               │   │
 │   │   │                │    │                │    │                │               │   │
 │   │   │ 1-2% total     │    │ (included)     │    │ (included)     │               │   │
 │   │   └────────────────┘    └────────────────┘    └────────────────┘               │   │
 │   └─────────────────────────────────────────────────────────────────────────────────┘   │
 │                                                                                          │
 └─────────────────────────────────────────────────────────────────────────────────────────┘


 ```

 ---
